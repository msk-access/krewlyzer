params {
    // Pipeline Options
    outdir = './results'
    ref = null          // Required
    targets = null      // Optional global targets
    
    // Genome Build & Correction
    genome = 'hg19'           // Genome build (hg19/hg38)
    gc_correct = true         // Enable GC correction
    pon_model = null          // Optional global PON model path
    
    // Assay-based asset resolution
    asset_dir = null          // Base directory for PON/targets lookup by assay
                              // Structure: {asset_dir}/pon/{assay}.pon.parquet
                              //            {asset_dir}/targets/{assay}_targets.bed
    
    // Panel-specific options
    bait_padding = 50         // Bait edge padding for WPS (bp)
    wps_anchors = null        // WPS anchors BED (auto-loaded if not specified)
    wps_background = null     // WPS background Alu BED (auto-loaded if not specified)
    
    // Filters & Algorithm Settings
    mapq = 20
    minlen = 65
    maxlen = 400
    skip_duplicates = true
    require_proper_pair = true
    exclude_regions = ''
    threads = 8

    // Logging & Observability
    verbose = false           // Enable verbose logging in tools

    // Output Format Options
    generate_json = false     // Generate unified sample.features.json for ML
    output_format = 'auto'    // Output format: auto, tsv, parquet, json

    // Boilerplate for nf-core standards
    monochrome_logs = false
    help = false
}

// Global Process Configuration
process {
    cpus = params.threads
    memory = '32 GB'
    time = '24h'
    shell = ['/bin/bash', '-euo', 'pipefail']

    // Publish Results organized by Sample ID
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[-1].toLowerCase() == 'runall' ? meta.id : meta.id}" },
        mode: 'copy',
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]
}

// Profiles
profiles {
    docker {
        docker.enabled = true
        singularity.enabled = false
        podman.enabled = false
        shifter.enabled = false
        charliecloud.enabled = false
    }
    
    slurm {
        process {
            executor = 'slurm'
            queue = 'cmobic_cpu'
            clusterOptions = '' // Add specific options if needed
        }
        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "${HOME}/.singularity_cache"
        }
        docker.enabled = false
    }
}

manifest {
    name = 'msk-access/krewlyzer'
    author = 'MSK-ACCESS Team'
    homePage = 'https://github.com/msk-access/krewlyzer'
    description = 'Fragmentation Features Pipeline'
    mainScript = 'main.nf'
    nextflowVersion = '!>=22.10.1'
    version = '0.2.0'
}
