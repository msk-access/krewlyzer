{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/msk-access/krewlyzer/main/nextflow/nextflow_schema.json",
    "title": "msk-access/krewlyzer pipeline parameters",
    "description": "Fragmentomics Feature Extraction Pipeline for cfDNA Analysis",
    "type": "object",
    "definitions": {
        "input_output_options": {
            "title": "Input/output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": [
                "ref"
            ],
            "properties": {
                "ref": {
                    "type": "string",
                    "format": "file-path",
                    "mimetype": "text/plain",
                    "pattern": "^\\S+\\.fa(sta)?(\\.gz)?$",
                    "description": "Path to reference genome FASTA (indexed)",
                    "fa_icon": "fas fa-file-alt"
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "Output directory for results",
                    "default": "./results",
                    "fa_icon": "fas fa-folder-open"
                },
                "targets": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Target regions BED (for panel data: GC model from off-target reads)",
                    "fa_icon": "fas fa-file"
                }
            }
        },
        "genome_options": {
            "title": "Genome options",
            "type": "object",
            "fa_icon": "fas fa-dna",
            "description": "Reference genome and GC correction settings.",
            "properties": {
                "genome": {
                    "type": "string",
                    "default": "hg19",
                    "description": "Genome build (hg19/hg38)",
                    "enum": [
                        "hg19",
                        "hg38",
                        "GRCh37",
                        "GRCh38"
                    ],
                    "fa_icon": "fas fa-dna"
                },
                "gc_correct": {
                    "type": "boolean",
                    "default": true,
                    "description": "Enable GC correction",
                    "fa_icon": "fas fa-adjust"
                },
                "pon_model": {
                    "type": "string",
                    "format": "file-path",
                    "description": "PON model for GC correction and z-scores",
                    "fa_icon": "fas fa-file"
                }
            }
        },
        "panel_options": {
            "title": "Panel options",
            "type": "object",
            "fa_icon": "fas fa-vials",
            "description": "Panel-specific settings for MSK-ACCESS and other panels.",
            "properties": {
                "asset_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "Base directory for PON/targets lookup by assay"
                },
                "bait_padding": {
                    "type": "integer",
                    "default": 50,
                    "minimum": 0,
                    "maximum": 200,
                    "description": "Bait edge padding for WPS (bp)"
                },
                "wps_anchors": {
                    "type": "string",
                    "format": "file-path",
                    "description": "WPS anchors BED (auto-loaded if not specified)"
                },
                "wps_background": {
                    "type": "string",
                    "format": "file-path",
                    "description": "WPS background Alu BED (auto-loaded if not specified)"
                }
            }
        },
        "filter_options": {
            "title": "Filter options",
            "type": "object",
            "fa_icon": "fas fa-filter",
            "description": "Fragment filtering parameters.",
            "properties": {
                "mapq": {
                    "type": "integer",
                    "default": 20,
                    "minimum": 0,
                    "maximum": 60,
                    "description": "Minimum mapping quality"
                },
                "minlen": {
                    "type": "integer",
                    "default": 65,
                    "minimum": 0,
                    "description": "Minimum fragment length"
                },
                "maxlen": {
                    "type": "integer",
                    "default": 400,
                    "maximum": 1000,
                    "description": "Maximum fragment length"
                },
                "skip_duplicates": {
                    "type": "boolean",
                    "default": true,
                    "description": "Skip duplicate reads"
                },
                "require_proper_pair": {
                    "type": "boolean",
                    "default": true,
                    "description": "Require proper pairs"
                },
                "exclude_regions": {
                    "type": "string",
                    "description": "BED file of regions to exclude"
                }
            }
        },
        "output_options": {
            "title": "Output options",
            "type": "object",
            "fa_icon": "fas fa-file-export",
            "description": "Output format settings.",
            "properties": {
                "generate_json": {
                    "type": "boolean",
                    "default": false,
                    "description": "Generate unified sample.features.json for ML"
                },
                "output_format": {
                    "type": "string",
                    "default": "auto",
                    "enum": [
                        "auto",
                        "tsv",
                        "parquet",
                        "json"
                    ],
                    "description": "Output format: auto, tsv, parquet, json"
                }
            }
        },
        "execution_options": {
            "title": "Execution options",
            "type": "object",
            "fa_icon": "fas fa-cogs",
            "description": "Execution and resource settings.",
            "properties": {
                "threads": {
                    "type": "integer",
                    "default": 8,
                    "minimum": 1,
                    "description": "Number of threads per process"
                },
                "verbose": {
                    "type": "boolean",
                    "default": false,
                    "description": "Enable verbose logging"
                }
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "fa_icon": "fas fa-question-circle",
            "description": "Less common options for the pipeline.",
            "properties": {
                "monochrome_logs": {
                    "type": "boolean",
                    "default": false,
                    "description": "Do not use ANSI colors in log output"
                },
                "help": {
                    "type": "boolean",
                    "default": false,
                    "description": "Display help text",
                    "hidden": true
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/definitions/input_output_options"
        },
        {
            "$ref": "#/definitions/genome_options"
        },
        {
            "$ref": "#/definitions/panel_options"
        },
        {
            "$ref": "#/definitions/filter_options"
        },
        {
            "$ref": "#/definitions/output_options"
        },
        {
            "$ref": "#/definitions/execution_options"
        },
        {
            "$ref": "#/definitions/generic_options"
        }
    ]
}